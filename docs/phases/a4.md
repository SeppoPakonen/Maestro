# Phase A4: Host System Package Recognition ðŸ’¡ **[Proposed]**

**Duration**: 3-4 weeks
**Dependencies**: Phase A3

**Objective**: Recognize and integrate host system packages into Maestro's dependency model.

## Concept

External dependencies may already be installed on the host system (via Portage, apt, pacman, etc.). We want to:
1. Recognize installed packages
2. Treat them as "installed ebuilds" with USE flags
3. Avoid rebuilding if satisfied
4. Handle version and USE flag compatibility

## Key Challenges

1. **USE Flag Detection**: Installed packages have USE flags, but detecting them is hard
2. **Multiple Package Managers**: Support Portage, apt, pacman, etc.
3. **Version Compatibility**: Ensure installed version satisfies requirements
4. **Flexibility**: The superset must handle this early in design

## Tasks

- [ ] **A4.1: Package Manager Detection**
  - [ ] Detect host package manager (Portage, apt, pacman, etc.)
  - [ ] Query installed packages
  - [ ] Extract package metadata

- [ ] **A4.2: Portage Package Query**
  - [ ] Query installed ebuilds
  - [ ] Extract USE flags from installed packages
  - [ ] Extract version information
  - [ ] Extract dependencies

- [ ] **A4.3: Generic Package Query (Non-Portage)**
  - [ ] Support apt (dpkg-query)
  - [ ] Support pacman
  - [ ] Support rpm/yum/dnf
  - [ ] Map to common format

- [ ] **A4.4: Integration with Dependency Resolution**
  - [ ] Check host packages before building
  - [ ] Version compatibility checking
  - [ ] USE flag compatibility checking (for Portage)
  - [ ] Prefer host packages when satisfied

- [ ] **A4.5: Fallback Strategy**
  - [ ] If host package doesn't satisfy requirements, build from source
  - [ ] Document limitations and workarounds

## Deliverables:
- Host package recognition
- Multi-package-manager support
- Integration with dependency resolution

## Test Criteria:
- Detects installed packages correctly
- Avoids unnecessary rebuilds
- Falls back to source builds when needed