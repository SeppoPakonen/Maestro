# Phase E4: Pedigree pup Package System Support ðŸ“‹ **[Planned]**

**Duration**: 2-3 weeks
**Dependencies**: Phase 1 (Core Builder)

## Background

Pedigree pup is a Python-based package system used by the Pedigree OS project. Each package is defined by a `package.py` file that:
- Inherits from `buildsystem.Package` base class
- Defines build phases: `download()`, `prebuild()`, `configure()`, `build()`, `deploy()`
- Specifies dependencies via `build_requires()` and `install_deps()`
- Supports patches and custom build steps

**Key Similarities to Portage**:
- Package-based dependency management
- Build phases (similar to ebuild functions)
- Patch application
- Build-time and runtime dependencies
- Deploy to staging directory before packaging

**Key Differences from Portage**:
- Python classes instead of bash scripts
- No USE flags (simpler configuration model)
- Cross-compilation focused (for Pedigree OS)
- Uses chroot for builds

## Tasks

- [ ] **E4.1: pup Package Scanner**
  - [ ] Create `scan_pup_packages()` in `build_systems.py`
  - [ ] Detect `packages/*/package.py` files
  - [ ] Parse Python package definitions
  - [ ] Extract metadata:
    - `name()`, `version()`
    - `build_requires()`, `install_deps()`
    - `patches()`
  - [ ] Build dependency graph

- [ ] **E4.2: pup Builder**
  - [ ] Create `pup.py` builder module
  - [ ] Implement Python class instantiation
  - [ ] Execute build phases in order:
    1. `download()` - fetch source
    2. `patch()` - apply patches
    3. `prebuild()` - prepare build
    4. `configure()` - run configure
    5. `build()` - compile
    6. `deploy()` - install to staging
    7. `postdeploy()` - post-install steps
  - [ ] Support environment variables (`env` dict)
  - [ ] Support custom srcdir and deploydir

- [ ] **E4.3: pup Infrastructure Integration**
  - [ ] Use existing `support/buildsystem.py` base class
  - [ ] Use existing `support/steps.py` helper functions
  - [ ] Integration with Maestro's dependency resolution
  - [ ] Cross-compilation environment setup

## Test Repository:
- `~/Dev/pedigree-apps` (pup package system)
- Test packages: bash, gcc, coreutils, etc.

## Deliverables:
- pup package scanner
- pup builder
- Integration with pedigree-apps infrastructure

## Test Criteria:
- Scan pedigree-apps packages successfully
- Build simple packages (bash, coreutils)
- Dependency resolution works
- Build phases execute in correct order

**Note**: This provides excellent preparation for Portage integration (Phase A2-A6), as pup shares similar concepts but is simpler to implement.