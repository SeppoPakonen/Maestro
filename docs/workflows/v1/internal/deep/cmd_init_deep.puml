@startuml cmd_init_deep
!include _shared.puml

' MODULE: MaestroMain, "maestro/main.py"
rectangle "main()" as MainEntry <<Function>>

' MODULE: CliParser, "maestro/modules/cli_parser.py"
rectangle "create_main_parser()" as CreateMainParser <<Function>>

' MODULE: CommandsInit, "maestro/commands/init.py"
rectangle "add_init_parser()" as AddInitParser <<Function>>
rectangle "handle_init_command()" as HandleInitCommand <<Function>>

' MODULE: Pathlib, "pathlib"
rectangle "Path" as PathClass <<Class>>

' MODULE: Builtins, "builtins"
rectangle "open()" as OpenFile <<Function>>

rectangle "Local Filesystem" as LocalFilesystem <<Data Store>>

' --- Relationships ---

' CLI Entry Point
MainEntry --> CreateMainParser : "1. Initializes parser"
CreateMainParser --> AddInitParser : "2. Adds 'init' command to parser"

' Command Execution Flow
MainEntry --> HandleInitCommand : "3. Dispatches 'init' command"

' Directory Creation
HandleInitCommand --> PathClass.mkdir : "4. Creates docs/ and subdirectories"
PathClass.mkdir --[#Red,dashed]-> LocalFilesystem : "Creates directories"

' Settings.md Creation
HandleInitCommand --> PathClass.exists : "5. Checks if docs/Settings.md exists"
PathClass.exists -[dashed]-> LocalFilesystem : "Reads file existence"
rectangle "args.force or not exists()" as ForceCheckSettings <<Validation Gate>>
HandleInitCommand --> ForceCheckSettings : "6. Conditional overwrite for Settings.md"
ForceCheckSettings --> OpenFile : "7. Creates docs/Settings.md"
OpenFile --[#Red,dashed]-> LocalFilesystem : "Writes file"

' RepoRules.md Creation
HandleInitCommand --> PathClass.exists : "8. Checks if docs/RepoRules.md exists"
PathClass.exists -[dashed]-> LocalFilesystem : "Reads file existence"
rectangle "args.force or not exists()" as ForceCheckRepoRules <<Validation Gate>>
HandleInitCommand --> ForceCheckRepoRepoRules : "9. Conditional overwrite for RepoRules.md"
ForceCheckRepoRepoRules --> OpenFile : "10. Creates docs/RepoRules.md"
OpenFile --[#Red,dashed]-> LocalFilesystem : "Writes file"

' Output to User
HandleInitCommand --> Stdout : "Prints status messages"
Stdout <.. HandleInitCommand

@enduml
