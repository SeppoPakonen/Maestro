@startuml cmd_solutions_deep
!include _shared.puml

' Core Command Modules
' MODULE: MaestroMain, "maestro/main.py"
rectangle "main()" as MainEntry <<Function>>

' MODULE: CommandsSolutions, "maestro/commands/solutions.py"
rectangle "add_solutions_parser()" as AddSolutionsParser <<Function>>
rectangle "handle_solutions_command()" as HandleSolutionsCommand <<Function>>
rectangle "_handle_list()" as _HandleList <<Function>>
rectangle "_handle_show()" as _HandleShow <<Function>>
rectangle "_handle_add()" as _HandleAdd <<Function>>
rectangle "_handle_remove()" as _HandleRemove <<Function>>
rectangle "_handle_edit()" as _HandleEdit <<Function>>
rectangle "_find_solution_path()" as _FindSolutionPath <<Function>>
rectangle "_open_editor()" as _OpenEditor <<Function>>
rectangle "_find_repo_root()" as _FindRepoRoot <<Function>>

' Solutions Subsystem Modules
' MODULE: SolutionsStore, "maestro/solutions/solution_store.py"
rectangle "list_solutions()" as ListSolutions <<Function>>
rectangle "list_external_solutions()" as ListExternalSolutions <<Function>>
rectangle "load_solution()" as LoadSolution <<Function>>
rectangle "write_solution()" as WriteSolution <<Function>>
rectangle "delete_solution()" as DeleteSolution <<Function>>
rectangle "SolutionDetails" as SolutionDetailsClass <<Class>>
rectangle "SolutionRecord" as SolutionRecordClass <<Class>>

' Utility Modules
' MODULE: MaestroUtils, "maestro/modules/utils.py"
    ' print_header, print_error etc.

' External Dependencies
rectangle "File System" as FileSystem <<Actor>>
rectangle "User's $EDITOR" as Editor <<Actor>>
rectangle "subprocess module" as Subprocess <<Actor>>

' Persistent Stores
rectangle "docs/solutions/<id>.md" as DocsSolutionsMd <<Database>>


' --- Relationships and Call Flow ---

' CLI Command Setup
MainEntry --> AddSolutionsParser : "Adds 'solutions' command and subparsers"

' Command Dispatch
HandleSolutionsCommand --> _FindRepoRoot : "Locates repo context"
HandleSolutionsCommand -- _HandleList
HandleSolutionsCommand -- _HandleShow
HandleSolutionsCommand -- _HandleAdd
HandleSolutionsCommand -- _HandleRemove
HandleSolutionsCommand -- _HandleEdit

' Solution Lifecycle Commands

' List Solutions
_HandleList --> SolutionsStore.ListSolutions --> DocsSolutionsMd : "reads local solutions"
_HandleList --> SolutionsStore.ListExternalSolutions : "reads external solutions (conceptual)"

' Show Solution
_HandleShow --> CommandsSolutions._FindSolutionPath : "locates solution file"
CommandsSolutions._FindSolutionPath --> DocsSolutionsMd : "checks existence"
_HandleShow --> SolutionsStore.LoadSolution --> DocsSolutionsMd : "loads and parses solution"

' Add Solution
_HandleAdd --> SolutionsStore.SolutionDetailsClass : "creates solution object"
_HandleAdd --> SolutionsStore.WriteSolution --[#Red,dashed]-> DocsSolutionsMd : "writes new solution file"
_HandleAdd --> CommandsSolutions._OpenEditor : "conditionally opens editor"
CommandsSolutions._OpenEditor --> Subprocess : "invokes external editor"
Editor <--> CommandsSolutions._OpenEditor

' Remove Solution
_HandleRemove --> SolutionsStore.DeleteSolution --[#Red,dashed]-> DocsSolutionsMd : "deletes solution file"

' Edit Solution
_HandleEdit --> CommandsSolutions._FindSolutionPath
_HandleEdit --> CommandsSolutions._OpenEditor : "opens solution file in editor"
CommandsSolutions._OpenEditor --> Subprocess : "invokes external editor"
Editor <--> CommandsSolutions._OpenEditor

' Helper Function Interactions
_FindRepoRoot --> FileSystem : "searches for .maestro"
_FindSolutionPath --> FileSystem : "locates solution file"

' Data Model interactions
SolutionRecordClass <.. SolutionsStore.LoadSolution : "parsed into"
SolutionDetailsClass <.. _HandleAdd : "created from args"

@enduml
