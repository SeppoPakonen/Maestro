# WF-11: Manual Repo Model + Manual RepoConf (Resolve Optional)

## Short Intent
This workflow documents how to manually author repo model and repo config, optionally augmenting a resolve pass.

## Preconditions
- Repository is adopted or ready for adoption
- User knows package structure and build drivers
- Manual configuration is acceptable

## Steps Table

| Step | Command | Why | Gates |
|------|---------|-----|-------|
| 1 | `maestro init` | Create repo truth storage for manual authoring | REPOCONF_GATE |
| 2 | `maestro repo package add "core" --path "src/core"` | Define a package entry in the repo model | REPOCONF_GATE |
| 3 | `maestro repo package set-language "core" --language "cpp"` | Declare the package language | REPOCONF_GATE |
| 4 | `maestro repo package set-driver "core" --driver "cmake"` | Set the package build driver | REPOCONF_GATE |
| 5 | `maestro repo conf target add "app" --type exe --package "core"` | Add a build target in RepoConf | REPOCONF_GATE |
| 6 | `maestro repo conf set-default-target "app"` | Select the default target | REPOCONF_GATE |
| 7 | `maestro repo resolve --level lite` | Optional resolve to augment manual data | REPO_RESOLVE_LITE |
| 8 | `maestro build --target "app"` | Build using manual RepoConf | READONLY_GUARD |
| 9 | `maestro tu --package "core"` | Generate TU/AST using manual RepoConf | READONLY_GUARD |

## Expected Internal Flow (Coarse)

- Manual package and config entries populate repo truth
- Optional resolve pass fills gaps or validates assumptions
- Repo model and conf are validated before build/TU operations
- Build/TU uses the manually authored configuration

## Data Touches

### Stores Read
- `REPO_TRUTH_DOCS_MAESTRO` - Read manual repo model and config
- `HOME_HUB_REPO` - Optional preferences and cache

### Stores Write
- `REPO_TRUTH_DOCS_MAESTRO` - Store manual repo model and repo conf

## Open Questions / Unknowns

- Are the package commands `maestro repo package add/set-language/set-driver` correct?
- Is the target command `maestro repo conf target add` correct?
- Is `maestro build --target` the correct build invocation for manual conf?
- Does `maestro tu --package` require additional flags?

## Trace Block

```yaml
trace:
  - user: "maestro init"
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo package add \"core\" --path \"src/core\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo package set-language \"core\" --language \"cpp\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo package set-driver \"core\" --driver \"cmake\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo conf target add \"app\" --type exe --package \"core\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo conf set-default-target \"app\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo resolve --level lite"
    gates: ["REPO_RESOLVE_LITE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro build --target \"app\""
    gates: ["READONLY_GUARD"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro tu --package \"core\""
    gates: ["READONLY_GUARD"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
```
