# WF-01: Existing Repository Adoption, Analysis, Build, and Run

## Short Intent
This workflow covers adopting an existing repository, analyzing its structure, building it, and running it successfully.

## Preconditions
- An existing code repository that is not yet managed by Maestro
- User has appropriate permissions to read and potentially write to the repository
- Build system is detectable (e.g., Makefile, CMakeLists.txt, package.json, etc.)

## Steps Table

| Step | Command | Why | Gates |
|------|---------|-----|-------|
| 1 | `maestro init` | Initialize the maestro environment in the current directory | REPOCONF_GATE |
| 2 | `maestro repo resolve --level lite` | Discover repository structure, build system, and dependencies | REPO_RESOLVE_LITE |
| 3 | `maestro repo config --show` | Validate/show/select default target configuration | REPOCONF_GATE |
| 4 | `maestro build` | Build the project using detected build system | READONLY_GUARD |
| 5 | `maestro run --grep-errors` | Run the built binary and check for errors | READONLY_GUARD |
| 6 | `maestro issue create --title "Initial analysis completed" --description "Repository analysis and initial build completed"` | Create an issue to track the initial adoption | REPOCONF_GATE |

## Expected Internal Flow (Coarse)

- Maestro initialization sets up internal tracking structures
- Repository resolver detects project type, build system, and dependencies
- Configuration gate validates or prompts for target configuration
- Build system integration attempts to compile the project
- Execution handler runs the built binary
- Issue tracker creates tracking items for completed work

## Data Touches

### Stores Read
- `REPO_TRUTH_DOCS_MAESTRO` - To check existing configuration
- `HOME_HUB_REPO` - For user-specific settings (if needed)

### Stores Write
- `REPO_TRUTH_DOCS_MAESTRO` - To store resolved repository structure, build configuration, and analysis results
- `IPC_MAILBOX` - For communication with external processes (build/run)

## Open Questions / Unknowns

- What is the exact command for repository configuration? Is it `maestro repo config` or something else?
- Is the build command `maestro build` or `maestro make`?
- What is the correct command to run a built binary with error checking?
- Are there specific parameters for issue creation?

## Trace Block

```yaml
trace:
  - user: "maestro init"
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo resolve --level lite"
    gates: ["REPO_RESOLVE_LITE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo config --show"
    gates: ["REPOCONF_GATE"]
    stores_read: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro build"
    gates: ["READONLY_GUARD"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro run --grep-errors"
    gates: ["READONLY_GUARD"]
    stores_read: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro issue create --title \"Initial analysis completed\" --description \"Repository analysis and initial build completed\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
```