# WF-10: Repo Resolve Levels â€” Lite vs Deep, Convention Acceptance, and Violation Policy

## Short Intent
This workflow covers lite vs deep resolve, convention inference/acceptance, and violation handling policies.

## Preconditions
- Repository exists and can be scanned
- User has permission to write repo truth
- Convention rule packs are available

## Steps Table

| Step | Command | Why | Gates |
|------|---------|-----|-------|
| 1 | `maestro repo resolve --level lite` | Perform a fast scan to detect build drivers and targets | REPO_RESOLVE_LITE |
| 2 | `maestro repo resolve --level deep` | Perform a deep scan to infer conventions and violations | REPO_RESOLVE_DEEP |
| 3 | `maestro conventions list` | List inferred convention packs | REPOCONF_GATE |
| 4 | `maestro conventions review` | Review proposed convention packs before acceptance | REPOCONF_GATE |
| 5 | `maestro conventions accept --pack "default"` | Accept a convention pack to enable enforcement | REPOCONF_GATE |
| 6 | `maestro conventions check` | Detect violations against accepted conventions | REPOCONF_GATE |
| 7 | `maestro issue create --title "Convention violations" --description "Violations detected during deep resolve"` | Track violations as issues | REPOCONF_GATE |
| 8 | `maestro conventions waive --id "VIOL-001" --reason "Legacy layout"` | Waive a blocking violation when approved | REPOCONF_GATE |

## Expected Internal Flow (Coarse)

- Lite resolve discovers build drivers and minimum build metadata
- Deep resolve infers conventions, frameworks, and violations
- Proposed convention packs are reviewed and accepted
- Violations are captured as issues and enforced by policy gates
- Waivers can be recorded to unblock operations

## Data Touches

### Stores Read
- `REPO_TRUTH_DOCS_MAESTRO` - Read repo model and convention candidates
- `HOME_HUB_REPO` - Read operator preferences and rule packs

### Stores Write
- `REPO_TRUTH_DOCS_MAESTRO` - Store resolved model, conventions, and violations
- `IPC_MAILBOX` - Communicate with external scanners/rule engines

## Open Questions / Unknowns

- Is `maestro repo resolve --level deep` the correct flag for deep resolve?
- Are convention commands `maestro conventions list/review/accept/check` correct or should they be namespaced under `repo`?
- Is `maestro conventions waive` the correct command for policy waivers?
- Should violations be stored via `maestro issue create` or a dedicated violations command?

## Trace Block

```yaml
trace:
  - user: "maestro repo resolve --level lite"
    gates: ["REPO_RESOLVE_LITE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo resolve --level deep"
    gates: ["REPO_RESOLVE_DEEP"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro conventions list"
    gates: ["REPOCONF_GATE"]
    stores_read: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro conventions review"
    gates: ["REPOCONF_GATE"]
    stores_read: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro conventions accept --pack \"default\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro conventions check"
    gates: ["REPOCONF_GATE"]
    stores_read: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro issue create --title \"Convention violations\" --description \"Violations detected during deep resolve\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro conventions waive --id \"VIOL-001\" --reason \"Legacy layout\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
```
