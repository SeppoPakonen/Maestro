# WF-02 Addon: Workflow-First Bootstrap (Greenfield)

## Short Intent
Seed a workflow graph before manual planning so manager intent, user intent, and interface candidates are captured as canonical spec inputs.

## Preconditions
- New repo or clean workspace
- Maestro initialized in the repo
- PlantUML available at `/usr/bin/plantuml`

## Steps Table

| Step | Command | Why | Gates |
|------|---------|-----|-------|
| 1 | `maestro init` | Initialize repo truth under `./docs/maestro/` | REPOCONF_GATE |
| 2 | `maestro workflow init product_spec` | Create a workflow graph JSON | REPO_TRUTH_IS_DOCS_MAESTRO, REPO_TRUTH_FORMAT_IS_JSON |
| 3 | `maestro workflow node add --graph product_spec --layer manager_intent --id MI-001 --title "Product intent"` | Capture manager intent | REPO_TRUTH_IS_DOCS_MAESTRO, REPO_TRUTH_FORMAT_IS_JSON |
| 4 | `maestro workflow node add --graph product_spec --layer user_intent --id UI-001 --title "User needs"` | Capture user intent | REPO_TRUTH_IS_DOCS_MAESTRO, REPO_TRUTH_FORMAT_IS_JSON |
| 5 | `maestro workflow node add --graph product_spec --layer interface --id IF-CLI --title "CLI interface"` | Add interface candidates | REPO_TRUTH_IS_DOCS_MAESTRO, REPO_TRUTH_FORMAT_IS_JSON |
| 6 | `maestro workflow edge add --graph product_spec --from MI-001 --to UI-001` | Link intent layers | REPO_TRUTH_IS_DOCS_MAESTRO, REPO_TRUTH_FORMAT_IS_JSON |
| 7 | `maestro workflow validate --graph product_spec` | Ensure graph invariants | REPO_TRUTH_IS_DOCS_MAESTRO, REPO_TRUTH_FORMAT_IS_JSON |
| 8 | `maestro workflow export --graph product_spec --format puml` | Export PlantUML for review | REPO_TRUTH_IS_DOCS_MAESTRO, REPO_TRUTH_FORMAT_IS_JSON |
| 9 | `maestro workflow render --graph product_spec --format svg` | Render SVG via PlantUML | REPO_TRUTH_IS_DOCS_MAESTRO, REPO_TRUTH_FORMAT_IS_JSON |
| 10 | Proceed with WF-02 manual plan steps | Transition to track/phase/task | REPOCONF_GATE |

## Expected Internal Flow (Coarse)
- `workflow init` creates a JSON graph in repo truth
- `workflow node/edge` updates the JSON graph
- `workflow validate` enforces schema and layer rules
- `workflow export` produces PlantUML output
- `workflow render` invokes `/usr/bin/plantuml -tsvg`

## Data Touches

### Stores Read
- `REPO_TRUTH_DOCS_MAESTRO` - to read and validate workflow graphs

### Stores Write
- `REPO_TRUTH_DOCS_MAESTRO` - to persist workflow graphs and exports

## Open Questions / Unknowns
- Exact CLI flags for workflow node/edge editing (spec placeholders)
- Should export/render output live under `./docs/maestro/workflows/` or a generated folder

## Trace Block

```yaml
trace:
  - user: "maestro init"
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro workflow init product_spec"
    gates: ["REPO_TRUTH_IS_DOCS_MAESTRO", "REPO_TRUTH_FORMAT_IS_JSON"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro workflow node add --graph product_spec --layer manager_intent --id MI-001 --title \"Product intent\""
    gates: ["REPO_TRUTH_IS_DOCS_MAESTRO", "REPO_TRUTH_FORMAT_IS_JSON"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro workflow node add --graph product_spec --layer user_intent --id UI-001 --title \"User needs\""
    gates: ["REPO_TRUTH_IS_DOCS_MAESTRO", "REPO_TRUTH_FORMAT_IS_JSON"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro workflow node add --graph product_spec --layer interface --id IF-CLI --title \"CLI interface\""
    gates: ["REPO_TRUTH_IS_DOCS_MAESTRO", "REPO_TRUTH_FORMAT_IS_JSON"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro workflow edge add --graph product_spec --from MI-001 --to UI-001"
    gates: ["REPO_TRUTH_IS_DOCS_MAESTRO", "REPO_TRUTH_FORMAT_IS_JSON"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro workflow validate --graph product_spec"
    gates: ["REPO_TRUTH_IS_DOCS_MAESTRO", "REPO_TRUTH_FORMAT_IS_JSON"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro workflow export --graph product_spec --format puml"
    gates: ["REPO_TRUTH_IS_DOCS_MAESTRO", "REPO_TRUTH_FORMAT_IS_JSON"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro workflow render --graph product_spec --format svg"
    gates: ["REPO_TRUTH_IS_DOCS_MAESTRO", "REPO_TRUTH_FORMAT_IS_JSON"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
```
