# WF-03: Read-Only Repository Inspection + Build Detection

## Short Intent
This workflow covers inspecting a repository in read-only mode, detecting build systems, and analyzing dependencies without modifying the repository's truth state.

## Preconditions
- An existing repository that should not be modified
- User has read permissions but not write permissions
- All outputs should go to the user's HOME_HUB_REPO instead of the repository's truth store

## Steps Table

| Step | Command | Why | Gates |
|------|---------|-----|-------|
| 1 | `maestro init --readonly` | Initialize maestro in read-only mode | READONLY_GUARD |
| 2 | `maestro repo resolve --level lite --readonly` | Discover repository structure without modifying repo truth | REPO_RESOLVE_LITE, READONLY_GUARD |
| 3 | `maestro scan build` | Detect build system without modifying project files | READONLY_GUARD |
| 4 | `maestro analyze deps --readonly` | Analyze project dependencies without writing to repo truth | READONLY_GUARD |
| 5 | `maestro build --dry-run` | Simulate build process without making changes | READONLY_GUARD |

## Expected Internal Flow (Coarse)

- Maestro initialization sets up read-only environment
- Repository resolver detects project structure and stores findings in HOME_HUB_REPO
- Build system scanner identifies build tools and configuration
- Dependency analyzer maps project dependencies
- Build simulation executes without modifying project state

## Data Touches

### Stores Read
- `REPO_TRUTH_DOCS_MAESTRO` - To read repository structure (if accessible)
- `HOME_HUB_REPO` - For user-specific settings and read-only cache

### Stores Write
- `HOME_HUB_REPO` - All outputs and analysis results go here instead of repo truth
- `IPC_MAILBOX` - For communication with external processes (build simulation)

## Open Questions / Unknowns

- Does the `--readonly` flag exist for `maestro init` or is read-only mode configured differently?
- Does the `--readonly` flag exist for `maestro repo resolve`?
- What is the exact command for build system scanning in read-only mode?
- Does the `--readonly` flag exist for dependency analysis?
- Is `--dry-run` the correct flag for simulating builds without changes?

## Trace Block

```yaml
trace:
  - user: "maestro init --readonly"
    gates: ["READONLY_GUARD"]
    stores_write: ["HOME_HUB_REPO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo resolve --level lite --readonly"
    gates: ["REPO_RESOLVE_LITE", "READONLY_GUARD"]
    stores_write: ["HOME_HUB_REPO"]
    internal: ["UNKNOWN"]
  - user: "maestro scan build"
    gates: ["READONLY_GUARD"]
    stores_write: ["HOME_HUB_REPO"]
    internal: ["UNKNOWN"]
  - user: "maestro analyze deps --readonly"
    gates: ["READONLY_GUARD"]
    stores_write: ["HOME_HUB_REPO"]
    internal: ["UNKNOWN"]
  - user: "maestro build --dry-run"
    gates: ["READONLY_GUARD"]
    stores_write: ["HOME_HUB_REPO"]
    internal: ["UNKNOWN"]
```