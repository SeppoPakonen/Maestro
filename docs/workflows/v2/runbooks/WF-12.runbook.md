# WF-12: RepoConf Gate â€” Required Targets/Configs for Build, TU, and Convert

## Short Intent
This workflow documents the RepoConf gate that must pass before build, TU, or convert operations.

## Preconditions
- Repository is adopted
- Repo model exists or can be resolved
- Build targets can be defined

## Steps Table

| Step | Command | Why | Gates |
|------|---------|-----|-------|
| 1 | `maestro repo resolve --level lite` | Generate RepoConf candidates from a scan | REPO_RESOLVE_LITE |
| 2 | `maestro repo conf target add "app" --type exe --package "core"` | Add a target definition to RepoConf | REPOCONF_GATE |
| 3 | `maestro repo conf set-default-target "app"` | Select a default target for operations | REPOCONF_GATE |
| 4 | `maestro repo conf show` | Confirm RepoConf contents and validity | REPOCONF_GATE |
| 5 | `maestro build --target "app"` | Execute a build using valid RepoConf | REPOCONF_GATE |
| 6 | `maestro tu --package "core"` | Generate TU/AST with valid RepoConf | REPOCONF_GATE |
| 7 | `maestro convert run --pipeline "example"` | Run conversion using valid RepoConf | REPOCONF_GATE |

## Expected Internal Flow (Coarse)

- Repo resolve or manual authoring creates RepoConf
- RepoConf is validated for schema, paths, and toolchain
- Default target selection is stored in RepoConf
- Build/TU/convert operations proceed only when RepoConf gate passes

## Data Touches

### Stores Read
- `REPO_TRUTH_DOCS_MAESTRO` - Read repo model and RepoConf
- `HOME_HUB_REPO` - Optional toolchain cache and preferences

### Stores Write
- `REPO_TRUTH_DOCS_MAESTRO` - Store RepoConf and default target

## Open Questions / Unknowns

- Is `maestro repo conf show` the correct command to validate RepoConf contents?
- Are `maestro repo conf target add` and `set-default-target` the correct commands?
- Do `maestro build`, `maestro tu`, and `maestro convert run` all check the same RepoConf gate?
- Are there dedicated validation commands for RepoConf schema/toolchain?

## Trace Block

```yaml
trace:
  - user: "maestro repo resolve --level lite"
    gates: ["REPO_RESOLVE_LITE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo conf target add \"app\" --type exe --package \"core\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo conf set-default-target \"app\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo conf show"
    gates: ["REPOCONF_GATE"]
    stores_read: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro build --target \"app\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro tu --package \"core\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro convert run --pipeline \"example\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
```
