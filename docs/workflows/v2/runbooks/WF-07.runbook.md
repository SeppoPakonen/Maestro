# WF-07: TU/AST Operations

## Short Intent
This workflow covers Translation Unit (TU) and Abstract Syntax Tree (AST) operations including symbol renaming, language transformation, and autocomplete queries.

## Preconditions
- Repository is properly resolved and configured
- Build system is set up to generate TUs
- AST analysis tools are available

## Steps Table

| Step | Command | Why | Gates |
|------|---------|-----|-------|
| 1 | `maestro repo resolve --level lite` | Resolve repository structure to enable TU/AST operations | REPO_RESOLVE_LITE |
| 2 | `maestro repo config --show` | Show current repository configuration to ensure proper setup | REPOCONF_GATE |
| 3 | `maestro tu build` | Build translation units for the project | READONLY_GUARD |
| 4 | `maestro tu rename --from "oldFunctionName" --to "newFunctionName"` | Rename the specified symbol across the codebase using AST | READONLY_GUARD |
| 5 | `maestro tu transform --from "C++" --to "JavaScript" --target "src/example.cpp"` | Transform C++ code to JavaScript using AST pipeline | READONLY_GUARD |
| 6 | `maestro tu autocomplete --context "MyClass." --position "src/main.cpp:15:10"` | Provide autocomplete suggestions based on AST analysis | REPOCONF_GATE |
| 7 | `maestro tu analyze --file "src/main.cpp"` | Run detailed AST analysis on the specified file | REPOCONF_GATE |

## Expected Internal Flow (Coarse)

- Repository resolver sets up project structure for TU operations
- Configuration validation ensures proper setup
- TU builder creates translation units from source files
- AST-based refactoring tools handle symbol renaming
- AST transformation pipeline converts between languages
- Autocomplete engine provides context-aware suggestions
- AST analyzer provides detailed code insights

## Data Touches

### Stores Read
- `REPO_TRUTH_DOCS_MAESTRO` - To read project structure and source files
- `HOME_HUB_REPO` - For user-specific settings and AST cache

### Stores Write
- `REPO_TRUTH_DOCS_MAESTRO` - To store TU information, AST analysis results, and refactoring changes
- `IPC_MAILBOX` - For communication with external AST tools

## Open Questions / Unknowns

- Is the command `maestro tu build` correct for building translation units?
- What is the exact command for symbol renaming via AST? Is it `maestro tu rename`?
- What is the exact command for AST-based language transformation? Is it `maestro tu transform`?
- What is the correct command for AST-based autocomplete queries? Is it `maestro tu autocomplete`?
- Is the command `maestro tu analyze` correct for AST analysis?

## Trace Block

```yaml
trace:
  - user: "maestro repo resolve --level lite"
    gates: ["REPO_RESOLVE_LITE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo config --show"
    gates: ["REPOCONF_GATE"]
    stores_read: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro tu build"
    gates: ["READONLY_GUARD"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro tu rename --from \"oldFunctionName\" --to \"newFunctionName\""
    gates: ["READONLY_GUARD"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro tu transform --from \"C++\" --to \"JavaScript\" --target \"src/example.cpp\""
    gates: ["READONLY_GUARD"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro tu autocomplete --context \"MyClass.\" --position \"src/main.cpp:15:10\""
    gates: ["REPOCONF_GATE"]
    stores_read: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro tu analyze --file \"src/main.cpp\""
    gates: ["REPOCONF_GATE"]
    stores_read: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
```