# WF-05: Repository Resolve Packages/Conventions/Targets

## Short Intent
This workflow covers deep repository analysis to detect packages, coding conventions, build targets, and project structure in detail.

## Preconditions
- An existing repository with code that follows certain conventions
- Build system is configured and operational
- User wants to understand the detailed structure of the repository

## Steps Table

| Step | Command | Why | Gates |
|------|---------|-----|-------|
| 1 | `maestro init` | Initialize the maestro environment in the current directory | REPOCONF_GATE |
| 2 | `maestro repo resolve --level deep` | Discover packages, conventions, targets, and project structure in detail | REPO_RESOLVE_LITE |
| 3 | `maestro conventions list` | List all detected coding and project conventions | REPOCONF_GATE |
| 4 | `maestro conventions review` | Present detected conventions for acceptance or modification | REPOCONF_GATE |
| 5 | `maestro targets list` | List all detected build targets | REPOCONF_GATE |
| 6 | `maestro conventions check` | Identify any violations of established conventions | REPOCONF_GATE |
| 7 | `maestro issue create --title "Convention Violations Found" --description "Issues created for detected convention violations"` | Create issues to track convention violations | REPOCONF_GATE |

## Expected Internal Flow (Coarse)

- Maestro initialization sets up tracking structures
- Deep repository resolver analyzes codebase in detail
- Convention detection system identifies coding and project patterns
- Convention review process allows acceptance or modification
- Target enumeration discovers all build targets
- Convention checker validates against established rules
- Issue tracker creates items for violations

## Data Touches

### Stores Read
- `REPO_TRUTH_DOCS_MAESTRO` - To read project structure and configuration
- `HOME_HUB_REPO` - For user-specific settings and convention preferences

### Stores Write
- `REPO_TRUTH_DOCS_MAESTRO` - To store detected packages, conventions, targets, and violations
- `IPC_MAILBOX` - For communication with external analysis tools

## Open Questions / Unknowns

- Is the command `maestro repo resolve --level deep` correct, or is there another command for deep analysis?
- What is the exact command for listing conventions? Is it `maestro conventions list`?
- What is the exact command for reviewing conventions? Is it `maestro conventions review`?
- What is the correct command for listing targets? Is it `maestro targets list`?
- What is the exact command for checking convention violations? Is it `maestro conventions check`?

## Trace Block

```yaml
trace:
  - user: "maestro init"
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro repo resolve --level deep"
    gates: ["REPO_RESOLVE_LITE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro conventions list"
    gates: ["REPOCONF_GATE"]
    stores_read: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro conventions review"
    gates: ["REPOCONF_GATE"]
    stores_read: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro targets list"
    gates: ["REPOCONF_GATE"]
    stores_read: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro conventions check"
    gates: ["REPOCONF_GATE"]
    stores_read: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
  - user: "maestro issue create --title \"Convention Violations Found\" --description \"Issues created for detected convention violations\""
    gates: ["REPOCONF_GATE"]
    stores_write: ["REPO_TRUTH_DOCS_MAESTRO"]
    internal: ["UNKNOWN"]
```