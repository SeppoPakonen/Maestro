id: "CMD-solutions"
layer: "code"
title: "solutions deep internal flow (observed)"
status: "partial"
confidence: "medium"
storage_backend: "markdown"

calls:
  - maestro.main.main
  - maestro.commands.solutions.handle_solutions_command
  - maestro.commands.solutions._find_repo_root
  - maestro.commands.solutions._handle_list
  - maestro.commands.solutions._handle_show
  - maestro.commands.solutions._handle_add
  - maestro.commands.solutions._handle_remove
  - maestro.commands.solutions._handle_edit
  - maestro.commands.solutions._find_solution_path
  - maestro.commands.solutions._open_editor
  - maestro.solutions.solution_store.list_solutions
  - maestro.solutions.solution_store.list_external_solutions
  - maestro.solutions.solution_store.load_solution
  - maestro.solutions.solution_store.write_solution
  - maestro.solutions.solution_store.delete_solution
  - maestro.solutions.solution_store.SolutionDetails
  - maestro.solutions.solution_store.SolutionRecord

stores:
  - docs/solutions/*.md
  - .maestro/

nodes:
  - id: "main_entry"
    type: "function"
    module: "maestro/main.py"
    function: "main"
  - id: "handle_solutions_command"
    type: "function"
    module: "maestro/commands/solutions.py"
    function: "handle_solutions_command"
  - id: "_find_repo_root"
    type: "function"
    module: "maestro/commands/solutions.py"
    function: "_find_repo_root"
  - id: "_handle_list"
    type: "function"
    module: "maestro/commands/solutions.py"
    function: "_handle_list"
  - id: "_handle_show"
    type: "function"
    module: "maestro/commands/solutions.py"
    function: "_handle_show"
  - id: "_handle_add"
    type: "function"
    module: "maestro/commands/solutions.py"
    function: "_handle_add"
  - id: "_handle_remove"
    type: "function"
    module: "maestro/commands/solutions.py"
    function: "_handle_remove"
  - id: "_handle_edit"
    type: "function"
    module: "maestro/commands/solutions.py"
    function: "_handle_edit"
  - id: "_find_solution_path"
    type: "function"
    module: "maestro/commands/solutions.py"
    function: "_find_solution_path"
  - id: "_open_editor"
    type: "function"
    module: "maestro/commands/solutions.py"
    function: "_open_editor"
  - id: "list_solutions"
    type: "function"
    module: "maestro/solutions/solution_store.py"
    function: "list_solutions"
  - id: "list_external_solutions"
    type: "function"
    module: "maestro/solutions/solution_store.py"
    function: "list_external_solutions"
  - id: "load_solution"
    type: "function"
    module: "maestro/solutions/solution_store.py"
    function: "load_solution"
  - id: "write_solution"
    type: "function"
    module: "maestro/solutions/solution_store.py"
    function: "write_solution"
  - id: "delete_solution"
    type: "function"
    module: "maestro/solutions/solution_store.py"
    function: "delete_solution"
  - id: "SolutionDetails"
    type: "class"
    module: "maestro/solutions/solution_store.py"
    class: "SolutionDetails"
  - id: "SolutionRecord"
    type: "class"
    module: "maestro/solutions/solution_store.py"
    class: "SolutionRecord"
  - id: "docs_solutions_md"
    type: "datastore"
    path: "docs/solutions/*.md"
  - id: "filesystem"
    type: "actor"
    label: "File System"
  - id: "editor"
    type: "actor"
    label: "User's $EDITOR"
  - id: "subprocess"
    type: "actor"
    label: "subprocess module"

edges:
  - from: "main_entry"
    to: "handle_solutions_command"
  - from: "handle_solutions_command"
    to: "_find_repo_root"
  - from: "handle_solutions_command"
    to: "_handle_list"
  - from: "handle_solutions_command"
    to: "_handle_show"
  - from: "handle_solutions_command"
    to: "_handle_add"
  - from: "handle_solutions_command"
    to: "_handle_remove"
  - from: "handle_solutions_command"
    to: "_handle_edit"
  - from: "_handle_list"
    to: "list_solutions"
  - from: "list_solutions"
    to: "docs_solutions_md"
  - from: "_handle_list"
    to: "list_external_solutions"
  - from: "_handle_show"
    to: "_find_solution_path"
  - from: "_find_solution_path"
    to: "docs_solutions_md"
  - from: "_handle_show"
    to: "load_solution"
  - from: "load_solution"
    to: "docs_solutions_md"
  - from: "_handle_add"
    to: "SolutionDetails"
  - from: "_handle_add"
    to: "write_solution"
  - from: "write_solution"
    to: "docs_solutions_md"
  - from: "_handle_add"
    to: "_open_editor"
  - from: "_open_editor"
    to: "subprocess"
  - from: "_open_editor"
    to: "editor"
  - from: "_handle_remove"
    to: "delete_solution"
  - from: "delete_solution"
    to: "docs_solutions_md"
  - from: "_handle_edit"
    to: "_find_solution_path"
  - from: "_handle_edit"
    to: "_open_editor"
  - from: "_find_repo_root"
    to: "filesystem"
  - from: "_find_solution_path"
    to: "filesystem"

evidence:
  - path: "maestro/commands/solutions.py"
    type: "source_code"
  - path: "maestro/solutions/solution_store.py"
    type: "source_code"
  - path: "docs/workflows/v1/internal/deep/cmd_solutions_deep.puml"
    type: "v1_diagram"

ledger_hints:
  - "Observed markdown persistence in cmd_solutions deep flow; v2 repo truth uses JSON. Replace/remove markdown codepaths and update docs/tests."
  - "Observed ./.maestro directory usage in _find_repo_root; violates FORBID_REPO_DOT_MAESTRO invariant; migrate to ./docs/maestro/"
