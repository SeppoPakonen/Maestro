id: CMD-root
layer: cli
title: root command surface
status: correct
confidence: high
storage_backend: unknown

commands:
  - maestro root get
  - maestro root set
  - maestro root refine
  - maestro root discuss
  - maestro root show

nodes:
  - id: cli_invocation
    type: command
    label: Maestro CLI Invocation
  - id: parse_args
    type: argparse
    label: Parse command line arguments
  - id: determine_root_command
    type: validation
    label: Determine command is 'root'
  - id: check_session
    type: validation
    label: Check if session is provided
  - id: load_session
    type: handler
    label: Load session
  - id: validate_session
    type: validation
    label: Validate session schema
  - id: check_subcommand
    type: validation
    label: Check if subcommand is provided
  - id: route_set
    type: subcommand
    label: Route to handle_root_set
  - id: route_get
    type: subcommand
    label: Route to handle_root_get
  - id: route_refine
    type: subcommand
    label: Route to handle_root_refine
  - id: route_discuss
    type: subcommand
    label: Route to handle_root_discuss
  - id: route_show
    type: subcommand
    label: Route to handle_root_show
  - id: show_help
    type: command
    label: Show root help
  - id: read_docs_truth
    type: handler
    label: Read docs truth store
  - id: execute_operation
    type: handler
    label: Execute root task operation
  - id: write_docs_truth
    type: handler
    label: Write docs truth store
  - id: output_results
    type: command
    label: Output results to stdout
  - id: exit_ok
    type: command
    label: Exit with success
  - id: exit_fail
    type: command
    label: Exit with failure
  - id: hard_stop
    type: hard_stop
    label: Hard stop - Session required

edges:
  - from: cli_invocation
    to: parse_args
    type: control
  - from: parse_args
    to: determine_root_command
    type: control
  - from: determine_root_command
    to: check_session
    type: control
  - from: check_session
    to: load_session
    label: Session provided
    type: control
  - from: check_session
    to: hard_stop
    label: Session not provided
    type: control
  - from: load_session
    to: validate_session
    type: control
  - from: validate_session
    to: check_subcommand
    type: control
  - from: check_subcommand
    to: route_set
    label: Subcommand is 'set'
    type: control
  - from: check_subcommand
    to: route_get
    label: Subcommand is 'get'
    type: control
  - from: check_subcommand
    to: route_refine
    label: Subcommand is 'refine'
    type: control
  - from: check_subcommand
    to: route_discuss
    label: Subcommand is 'discuss'
    type: control
  - from: check_subcommand
    to: route_show
    label: Subcommand is 'show'
    type: control
  - from: check_subcommand
    to: show_help
    label: No or invalid subcommand
    type: control
  - from: route_set
    to: read_docs_truth
    type: control
  - from: route_get
    to: read_docs_truth
    type: control
  - from: route_refine
    to: read_docs_truth
    type: control
  - from: route_discuss
    to: read_docs_truth
    type: control
  - from: route_show
    to: read_docs_truth
    type: control
  - from: read_docs_truth
    to: execute_operation
    type: control
  - from: execute_operation
    to: write_docs_truth
    type: control
  - from: write_docs_truth
    to: output_results
    type: control
  - from: output_results
    to: exit_ok
    type: control
  - from: show_help
    to: exit_fail
    type: control
  - from: hard_stop
    to: exit_fail
    type: control

exports:
  - writes session file
  - updates root task data in docs/
  - outputs root task information to stdout

evidence:
  - path: maestro/modules/cli_parser.py
    description: Implementation of root command in CLI parser
  - path: cmd_root.md
    description: Documentation of root command internal workflow
