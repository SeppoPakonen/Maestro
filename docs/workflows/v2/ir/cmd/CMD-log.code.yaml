id: "CMD-log"
layer: "code"
title: "log deep internal flow (observed)"
status: "partial"
confidence: "medium"
storage_backend: "unknown"

calls:
  - "maestro/main.py::main()"
  - "maestro/modules/command_handlers.py::handle_log_list()"
  - "maestro/modules/command_handlers.py::handle_log_list_work()"
  - "maestro/modules/command_handlers.py::handle_log_list_plan()"
  - "maestro/modules/command_handlers.py::load_session()"
  - "maestro/modules/command_handlers.py::get_maestro_dir()"
  - "maestro/session_model.py::Session"
  - "maestro/session_model.py::Subtask"

stores:
  - "docs/sessions/<name>/session.json"
  - "docs/sessions/<name>/logs/events.log"
  - "docs/sessions/<name>/outputs/worker_*.stdout.txt"
  - "docs/sessions/<name>/inputs/planner_*.txt"

nodes:
  - id: "main_entry"
    type: "function"
    module: "maestro/main.py"
    function: "main()"
  - id: "handle_log_list"
    type: "function"
    module: "maestro/modules/command_handlers.py"
    function: "handle_log_list()"
  - id: "handle_log_list_work"
    type: "function"
    module: "maestro/modules/command_handlers.py"
    function: "handle_log_list_work()"
  - id: "handle_log_list_plan"
    type: "function"
    module: "maestro/modules/command_handlers.py"
    function: "handle_log_list_plan()"
  - id: "load_session"
    type: "function"
    module: "maestro/modules/command_handlers.py"
    function: "load_session()"
  - id: "get_maestro_dir"
    type: "function"
    module: "maestro/modules/command_handlers.py"
    function: "get_maestro_dir()"
  - id: "session_class"
    type: "class"
    module: "maestro/session_model.py"
    class: "Session"
  - id: "subtask_class"
    type: "class"
    module: "maestro/session_model.py"
    class: "Subtask"
  - id: "maestro_utils"
    type: "module"
    module: "maestro/modules/utils.py"
  - id: "docs_sessions_dir"
    type: "datastore"
    description: "Session directory with logs and data"
  - id: "file_system"
    type: "actor"
    description: "File system operations"
  - id: "pathlib"
    type: "actor"
    description: "Path operations"
  - id: "os"
    type: "actor"
    description: "OS operations"

edges:
  - from: "main_entry"
    to: "handle_log_list"
  - from: "main_entry"
    to: "handle_log_list_work"
  - from: "main_entry"
    to: "handle_log_list_plan"
  - from: "handle_log_list"
    to: "docs_sessions_dir"
    label: "reads logs/events.log"
  - from: "handle_log_list"
    to: "maestro_utils"
    label: "prints log content"
  - from: "handle_log_list_work"
    to: "docs_sessions_dir"
    label: "reads outputs/worker_*.stdout.txt"
  - from: "handle_log_list_work"
    to: "session_class"
    label: "iterates session.subtasks"
  - from: "handle_log_list_work"
    to: "maestro_utils"
    label: "prints log content"
  - from: "handle_log_list_plan"
    to: "docs_sessions_dir"
    label: "reads inputs/planner_*.txt"
  - from: "handle_log_list_plan"
    to: "maestro_utils"
    label: "prints log content"
  - from: "load_session"
    to: "docs_sessions_dir"
    label: "reads session.json"
  - from: "get_maestro_dir"
    to: "docs_sessions_dir"
    label: "determines session directory"
  - from: "load_session"
    to: "session_class"
    label: "loads session data"
  - from: "session_class"
    to: "subtask_class"
    label: "accessed for logs"
  - from: "docs_sessions_dir"
    to: "file_system"
    label: "reads log files"
  - from: "pathlib"
    to: "command_handlers"
    label: "for path operations"
  - from: "os"
    to: "command_handlers"
    label: "for path operations"

evidence:
  - "v1/internal/deep/cmd_log_deep.puml"
  - "v1/internal/deep/cmd_log_deep.md"
