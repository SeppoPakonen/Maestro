id: "CMD-log"
layer: "code"
title: "log deep internal flow (observed)"
status: "partial"
confidence: "medium"
storage_backend: "json"

calls:
  - "maestro/main.py::main()"
  - "maestro/modules/command_handlers.py::handle_log_list()"
  - "maestro/modules/command_handlers.py::handle_log_list_work()"
  - "maestro/modules/command_handlers.py::handle_log_list_plan()"
  - "maestro/modules/command_handlers.py::load_session()"
  - "maestro/modules/command_handlers.py::get_maestro_dir()"
  - "maestro/session_model.py::Session"
  - "maestro/session_model.py::Subtask"

stores:
  - "docs/sessions/<name>/session.json"
  - "docs/sessions/<name>/logs/events.log"
  - "docs/sessions/<name>/outputs/worker_*.stdout.txt"
  - "docs/sessions/<name>/inputs/planner_*.txt"

nodes:
  - id: "main_entry"
    type: "function"
    module: "maestro/main.py"
    function: "main"
  - id: "handle_log_list"
    type: "function"
    module: "maestro/modules/command_handlers.py"
    function: "handle_log_list"
  - id: "handle_log_list_work"
    type: "function"
    module: "maestro/modules/command_handlers.py"
    function: "handle_log_list_work"
  - id: "handle_log_list_plan"
    type: "function"
    module: "maestro/modules/command_handlers.py"
    function: "handle_log_list_plan"
  - id: "load_session"
    type: "function"
    module: "maestro/modules/command_handlers.py"
    function: "load_session"
  - id: "get_maestro_dir"
    type: "function"
    module: "maestro/modules/command_handlers.py"
    function: "get_maestro_dir"
  - id: "session_class"
    type: "class"
    module: "maestro/session_model.py"
    class: "Session"
  - id: "subtask_class"
    type: "class"
    module: "maestro/session_model.py"
    class: "Subtask"
  - id: "docs_sessions_dir"
    type: "datastore"
    path: "docs/sessions/<name>/"
  - id: "filesystem"
    type: "actor"
    label: "File System"
  - id: "pathlib"
    type: "actor"
    label: "pathlib module"
  - id: "os"
    type: "actor"
    label: "os module"

edges:
  - from: "main_entry"
    to: "handle_log_list"
  - from: "main_entry"
    to: "handle_log_list_work"
  - from: "main_entry"
    to: "handle_log_list_plan"
  - from: "handle_log_list"
    to: "docs_sessions_dir"
    label: "reads logs/events.log"
  - from: "handle_log_list_work"
    to: "docs_sessions_dir"
    label: "reads outputs/worker_*.stdout.txt"
  - from: "handle_log_list_plan"
    to: "docs_sessions_dir"
    label: "reads inputs/planner_*.txt"
  - from: "load_session"
    to: "docs_sessions_dir"
    label: "reads session.json"
  - from: "handle_log_list_work"
    to: "session_class"
    label: "iterates session.subtasks"
  - from: "docs_sessions_dir"
    to: "filesystem"
    label: "reads log files"
  - from: "command_handlers"
    to: "pathlib"
    label: "for path operations"
  - from: "command_handlers"
    to: "os"
    label: "for path operations"

evidence:
  - "v1/internal/deep/cmd_log_deep.puml"
  - "maestro/main.py"
  - "maestro/modules/command_handlers.py"
  - "maestro/session_model.py"

ledger_hints:
  - "Observed JSON persistence in cmd_log deep flow with session.json and other JSON files; aligns with v2 repo truth using JSON."
