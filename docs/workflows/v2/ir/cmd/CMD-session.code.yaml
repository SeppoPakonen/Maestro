id: "CMD-session"
layer: "code"
title: "session deep internal flow (observed)"
status: "partial"
confidence: "high"
storage_backend: "json"

calls:
  - maestro.main.main
  - maestro.modules.command_handlers.handle_session_new
  - maestro.modules.command_handlers.handle_session_list
  - maestro.modules.command_handlers.handle_session_set
  - maestro.modules.command_handlers.handle_session_get
  - maestro.modules.command_handlers.handle_session_remove
  - maestro.modules.command_handlers.handle_session_details
  - maestro.commands.work_session.handle_wsession_breadcrumbs
  - maestro.commands.work_session.handle_wsession_timeline
  - maestro.commands.work_session.handle_wsession_stats
  - maestro.modules.command_handlers.get_session_path_by_name
  - maestro.modules.command_handlers.create_session
  - maestro.modules.command_handlers.set_active_session_name
  - maestro.modules.command_handlers.list_sessions
  - maestro.modules.command_handlers.get_active_session_name
  - maestro.modules.command_handlers.get_session_details
  - maestro.session_model.load_session
  - maestro.modules.command_handlers.remove_session
  - maestro.modules.command_handlers.edit_root_task_in_editor

stores:
  - docs/sessions/<session-name>/session.json
  - ~/.maestro/config.json

nodes:
  - id: main_dispatch
    type: function
    label: maestro.main.main
    module: maestro.main
    function: main
  - id: handle_session_new
    type: function
    label: handle_session_new
    module: maestro.modules.command_handlers
    function: handle_session_new
  - id: handle_session_list
    type: function
    label: handle_session_list
    module: maestro.modules.command_handlers
    function: handle_session_list
  - id: handle_session_set
    type: function
    label: handle_session_set
    module: maestro.modules.command_handlers
    function: handle_session_set
  - id: handle_session_get
    type: function
    label: handle_session_get
    module: maestro.modules.command_handlers
    function: handle_session_get
  - id: handle_session_remove
    type: function
    label: handle_session_remove
    module: maestro.modules.command_handlers
    function: handle_session_remove
  - id: handle_session_details
    type: function
    label: handle_session_details
    module: maestro.modules.command_handlers
    function: handle_session_details
  - id: handle_wsession_breadcrumbs
    type: function
    label: handle_wsession_breadcrumbs
    module: maestro.commands.work_session
    function: handle_wsession_breadcrumbs
  - id: handle_wsession_timeline
    type: function
    label: handle_wsession_timeline
    module: maestro.commands.work_session
    function: handle_wsession_timeline
  - id: handle_wsession_stats
    type: function
    label: handle_wsession_stats
    module: maestro.commands.work_session
    function: handle_wsession_stats
  - id: get_session_path_by_name
    type: function
    label: get_session_path_by_name
    module: maestro.modules.command_handlers
    function: get_session_path_by_name
  - id: create_session
    type: function
    label: create_session
    module: maestro.modules.command_handlers
    function: create_session
  - id: set_active_session_name
    type: function
    label: set_active_session_name
    module: maestro.modules.command_handlers
    function: set_active_session_name
  - id: list_sessions
    type: function
    label: list_sessions
    module: maestro.modules.command_handlers
    function: list_sessions
  - id: get_active_session_name
    type: function
    label: get_active_session_name
    module: maestro.modules.command_handlers
    function: get_active_session_name
  - id: get_session_details
    type: function
    label: get_session_details
    module: maestro.modules.command_handlers
    function: get_session_details
  - id: load_session
    type: function
    label: load_session
    module: maestro.session_model
    function: load_session
  - id: remove_session
    type: function
    label: remove_session
    module: maestro.modules.command_handlers
    function: remove_session
  - id: edit_root_task_in_editor
    type: function
    label: edit_root_task_in_editor
    module: maestro.modules.command_handlers
    function: edit_root_task_in_editor
  - id: session_json_store
    type: datastore
    label: Session JSON Store
    path: docs/sessions/<session-name>/session.json
  - id: user_config_store
    type: datastore
    label: User Config Store
    path: ~/.maestro/config.json

edges:
  - from: main_dispatch
    to: handle_session_new
    type: call
  - from: main_dispatch
    to: handle_session_list
    type: call
  - from: main_dispatch
    to: handle_session_set
    type: call
  - from: main_dispatch
    to: handle_session_get
    type: call
  - from: main_dispatch
    to: handle_session_remove
    type: call
  - from: main_dispatch
    to: handle_session_details
    type: call
  - from: main_dispatch
    to: handle_wsession_breadcrumbs
    type: call
  - from: main_dispatch
    to: handle_wsession_timeline
    type: call
  - from: main_dispatch
    to: handle_wsession_stats
    type: call
  - from: handle_session_new
    to: get_session_path_by_name
    type: call
  - from: handle_session_new
    to: create_session
    type: call
  - from: handle_session_new
    to: set_active_session_name
    type: call
  - from: handle_session_new
    to: edit_root_task_in_editor
    type: call
  - from: handle_session_list
    to: list_sessions
    type: call
  - from: handle_session_list
    to: get_active_session_name
    type: call
  - from: handle_session_list
    to: get_session_details
    type: call
  - from: handle_session_set
    to: list_sessions
    type: call
  - from: handle_session_set
    to: get_session_path_by_name
    type: call
  - from: handle_session_set
    to: set_active_session_name
    type: call
  - from: handle_session_get
    to: get_active_session_name
    type: call
  - from: handle_session_get
    to: get_session_details
    type: call
  - from: handle_session_remove
    to: get_session_path_by_name
    type: call
  - from: handle_session_remove
    to: remove_session
    type: call
  - from: handle_session_details
    to: list_sessions
    type: call
  - from: handle_session_details
    to: get_session_details
    type: call
  - from: handle_session_details
    to: load_session
    type: call
  - from: create_session
    to: session_json_store
    type: data
  - from: set_active_session_name
    to: user_config_store
    type: data
  - from: remove_session
    to: session_json_store
    type: data
  - from: get_session_details
    to: session_json_store
    type: data
  - from: load_session
    to: session_json_store
    type: data

evidence:
  - /home/sblo/Dev/Maestro/maestro/modules/command_handlers.py
  - /home/sblo/Dev/Maestro/maestro/commands/work_session.py
  - /home/sblo/Dev/Maestro/maestro/session_model.py
