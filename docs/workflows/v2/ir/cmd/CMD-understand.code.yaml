id: "CMD-understand"
layer: "code"
title: "understand deep internal flow (observed)"
status: "correct"
confidence: "high"
storage_backend: "markdown"

calls:
  - maestro.main.main
  - maestro.commands.understand.add_understand_parser
  - maestro.understand.command.handle_understand_dump
  - maestro.understand.introspector.ProjectIntrospector
  - maestro.understand.renderer.MarkdownRenderer
  - maestro.modules.utils.print_success
  - maestro.modules.utils.print_error

stores:
  - docs/UNDERSTANDING_SNAPSHOT.md

nodes:
  - id: "main_entry"
    type: "function"
    module: "maestro/main.py"
    function: "main"
  - id: "add_understand_parser"
    type: "function"
    module: "maestro/commands/understand/__init__.py"
    function: "add_understand_parser"
  - id: "handle_understand_dump"
    type: "function"
    module: "maestro/understand/command.py"
    function: "handle_understand_dump"
  - id: "project_introspector_class"
    type: "class"
    module: "maestro/understand/introspector.py"
    class: "ProjectIntrospector"
  - id: "gather_all"
    type: "function"
    module: "maestro/understand/introspector.py"
    function: "gather_all"
  - id: "gather_identity"
    type: "function"
    module: "maestro/understand/introspector.py"
    function: "gather_identity"
  - id: "gather_authority_model"
    type: "function"
    module: "maestro/understand/introspector.py"
    function: "gather_authority_model"
  - id: "gather_rule_gates"
    type: "function"
    module: "maestro/understand/introspector.py"
    function: "gather_rule_gates"
  - id: "gather_mutation_boundaries"
    type: "function"
    module: "maestro/understand/introspector.py"
    function: "gather_mutation_boundaries"
  - id: "gather_automation_long_run"
    type: "function"
    module: "maestro/understand/introspector.py"
    function: "gather_automation_long_run"
  - id: "gather_directory_semantics"
    type: "function"
    module: "maestro/understand/introspector.py"
    function: "gather_directory_semantics"
  - id: "gather_contracts"
    type: "function"
    module: "maestro/understand/introspector.py"
    function: "gather_contracts"
  - id: "gather_evidence_index"
    type: "function"
    module: "maestro/understand/introspector.py"
    function: "gather_evidence_index"
  - id: "markdown_renderer_class"
    type: "class"
    module: "maestro/understand/renderer.py"
    class: "MarkdownRenderer"
  - id: "render"
    type: "function"
    module: "maestro/understand/renderer.py"
    function: "render"
  - id: "_render_identity"
    type: "function"
    module: "maestro/understand/renderer.py"
    function: "_render_identity"
  - id: "_render_authority_model"
    type: "function"
    module: "maestro/understand/renderer.py"
    function: "_render_authority_model"
  - id: "_render_rule_gates"
    type: "function"
    module: "maestro/understand/renderer.py"
    function: "_render_rule_gates"
  - id: "filesystem"
    type: "actor"
    label: "File System"
  - id: "pathlib"
    type: "actor"
    label: "pathlib"
  - id: "docs_understanding_snapshot_md"
    type: "datastore"
    label: "docs/UNDERSTANDING_SNAPSHOT.md"

edges:
  - from: "main_entry"
    to: "add_understand_parser"
    label: "Adds 'understand' command"
  - from: "add_understand_parser"
    to: "handle_understand_dump"
    label: "registers handler for 'dump'"
  - from: "main_entry"
    to: "handle_understand_dump"
    label: "dispatches 'understand dump'"
  - from: "handle_understand_dump"
    to: "project_introspector_class"
    label: "1. Initialize Introspector"
  - from: "handle_understand_dump"
    to: "markdown_renderer_class"
    label: "2. Initialize Renderer"
  - from: "render"
    to: "gather_all"
    label: "3. Gather all project data"
  - from: "gather_all"
    to: "gather_identity"
    label: "  - gathers identity"
  - from: "gather_all"
    to: "gather_authority_model"
    label: "  - gathers authority model"
  - from: "gather_all"
    to: "gather_rule_gates"
    label: "  - gathers rule gates"
  - from: "gather_all"
    to: "gather_mutation_boundaries"
    label: "  - gathers mutation boundaries"
  - from: "gather_all"
    to: "gather_automation_long_run"
    label: "  - gathers automation long run"
  - from: "gather_all"
    to: "gather_directory_semantics"
    label: "  - gathers directory semantics"
  - from: "gather_all"
    to: "gather_contracts"
    label: "  - gathers contracts"
  - from: "gather_all"
    to: "gather_evidence_index"
    label: "  - gathers evidence index"
  - from: "render"
    to: "_render_identity"
    label: "4. Render sections to Markdown"
  - from: "render"
    to: "_render_authority_model"
  - from: "render"
    to: "_render_rule_gates"
  - from: "handle_understand_dump"
    to: "pathlib"
    label: "path management"
  - from: "pathlib"
    to: "filesystem"
    label: "interacts with filesystem"
  - from: "handle_understand_dump"
    to: "docs_understanding_snapshot_md"
    label: "specifies output file"

evidence:
  - "v1/internal/deep/cmd_understand_deep.md"
  - "v1/internal/deep/cmd_understand_deep.puml"

ledger_hints:
  - "Observed DataMarkdown persistence in cmd_understand deep flow; v2 repo truth uses JSON. Replace/remove DataMarkdown codepaths and update docs/tests."
