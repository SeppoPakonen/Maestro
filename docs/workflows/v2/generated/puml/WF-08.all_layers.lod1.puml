@startuml
!theme plain
skinparam backgroundColor #FFFFFF
skinparam defaultFontName Arial
skinparam ArrowColor #333333
skinparam NoteBorderColor #CCCCCC
skinparam NoteBackgroundColor #FFFFCC

title WF-08 - Combined Layers (LOD1)

note right
  **Source:** [[docs/workflows/v2/ir/wf/WF-08.intent.yaml docs/workflows/v2/ir/wf/WF-08.intent.yaml]]
end note

note as N1
  **Combined view (LOD1)**
  
  This diagram combines:
  * Intent layer (workflow logic)
  * Command integration
end note

!theme plain
skinparam backgroundColor #FFFFFF
skinparam defaultFontName Arial
skinparam ArrowColor #333333
skinparam NoteBorderColor #CCCCCC
skinparam NoteBackgroundColor #FFFFCC

title WF-08 - Convert â€” cross-repo pipeline (New/Plan/Run) (LOD1: Workflow)

note right
  **Source:** [[docs/workflows/v2/ir/wf/WF-08.intent.yaml docs/workflows/v2/ir/wf/WF-08.intent.yaml]]
end note

(*) --> "Operator initiates conversion pipeline"
stop
:Create conversion pipeline instance;
:Create pipeline metadata;
:Plan conversion with AI assistance;
:Initiate AI planning session;
:Generate conversion plan;
:Validate plan JSON;
:Save plan JSON;
:Call WF-05 Repo Resolve;
:Ensure AST is available;
:Generate AST from source;
:Export AST;
:Initialize target repository;
:Create target repo structure;
:Emit tasks to target repository;
:Run conversion pipeline;
:Validate plan and prerequisites;
:Execute conversion tasks in target repo;
:Process scaffold tasks;
:Process file conversion tasks;
:Process final sweep tasks;
:Run semantic integrity checks;
:Check for semantic equivalence;
"Return execution status to operator" --> (*)
' branch_guard -> convert_new: Branch switching not detected
' validate_plan_json -> save_plan_json: Plan is valid
' validate_plan_json -> end: Plan is invalid - Hard stop
' ensure_ast_available -> generate_ast: AST is available
' ensure_ast_available -> end: AST unavailable - Hard stop
' validate_prerequisites -> execute_conversion_tasks: Prerequisites met

package "Command Integration" #E6F3FF {
  component "convert\ncommand" as cmd_convert [[../generated/svg/CMD-convert.all_layers.lod1.svg]]
  component "repo\ncommand" as cmd_repo [[../generated/svg/CMD-repo.all_layers.lod1.svg]]
}

note left
  **Evidence:**
  * [[v1/scenario_08_convert_cross_repo_pipeline.md Original v1 scenario documentation]]
  * [[v1/scenario_08_convert_cross_repo_pipeline.puml Original v1 PlantUML diagram]]
end note


@enduml
