@startuml
!theme plain
skinparam backgroundColor #FFFFFF
skinparam defaultFontName Arial
skinparam ArrowColor #333333
skinparam NoteBorderColor #CCCCCC
skinparam NoteBackgroundColor #FFFFCC

title CMD-resume - resume deep internal flow (observed) (LOD1: Code Functions)

note right
  **Source:** [[docs/workflows/v2/ir/cmd/CMD-resume.code.yaml docs/workflows/v2/ir/cmd/CMD-resume.code.yaml]]
end note

rectangle "main_entry\n(maestro/main.py)" as main_entry
rectangle "handle_resume_session\n(maestro/modules/command_handlers.py)" as handle_resume_session
rectangle "load_session\n(maestro/modules/command_handlers.py)" as load_session
rectangle "save_session\n(maestro/modules/command_handlers.py)" as save_session
rectangle "update_subtask_summary_paths\n(maestro/modules/command_handlers.py)" as update_subtask_summary_paths
rectangle "has_legacy_plan\n(maestro/modules/command_handlers.py)" as has_legacy_plan
rectangle "migrate_session_if_needed\n(maestro/modules/command_handlers.py)" as migrate_session_if_needed
rectangle "load_rules\n(maestro/modules/command_handlers.py)" as load_rules
rectangle "get_maestro_dir\n(maestro/modules/command_handlers.py)" as get_maestro_dir
rectangle "build_prompt\n(maestro/modules/command_handlers.py)" as build_prompt
rectangle "save_prompt_for_traceability\n(maestro/modules/command_handlers.py)" as save_prompt_for_traceability
rectangle "save_ai_output\n(maestro/modules/command_handlers.py)" as save_ai_output
rectangle "get_engine\n(maestro/engines.py)" as get_engine
main_entry --> handle_resume_session
handle_resume_session --> load_session
load_session --> docs_sessions_dir
handle_resume_session --> update_subtask_summary_paths
handle_resume_session --> has_legacy_plan
handle_resume_session --> migrate_session_if_needed
handle_resume_session --> load_rules
load_rules --> docs_sessions_dir
handle_resume_session --> session_class
handle_resume_session --> get_maestro_dir
get_maestro_dir --> file_system
handle_resume_session --> build_prompt
handle_resume_session --> get_engine
handle_resume_session --> save_prompt_for_traceability
save_prompt_for_traceability --> docs_sessions_dir
handle_resume_session --> external_ai
external_ai --> handle_resume_session
handle_resume_session --> save_ai_output
handle_resume_session --> file_system
handle_resume_session --> session_class

note left
  **Evidence:**
  * [[v1/internal/deep/cmd_resume_deep.puml cmd_resume_deep.puml]]
  * [[v1/internal/deep/cmd_resume_deep.md cmd_resume_deep.md]]
end note

note right #FFE6E6
  **âš  Ledger Hints:**
  * Observed DataMarkdown persistence in cmd_resume deep flow; v2 repo truth uses JS
  
  [[../../IMPLEMENTATION_LEDGER.md IMPLEMENTATION_LEDGER]]
  [[../../reports/ledger_candidates.md Ledger Candidates]]
end note

@enduml
