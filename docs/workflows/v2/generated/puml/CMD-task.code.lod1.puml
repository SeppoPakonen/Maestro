@startuml
!theme plain
skinparam backgroundColor #FFFFFF
skinparam defaultFontName Arial
skinparam ArrowColor #333333
skinparam NoteBorderColor #CCCCCC
skinparam NoteBackgroundColor #FFFFCC

title CMD-task - task deep internal flow (observed) (LOD1: Code Functions)

note right
  **Source:** [[docs/workflows/v2/ir/cmd/CMD-task.code.yaml docs/workflows/v2/ir/cmd/CMD-task.code.yaml]]
end note

rectangle "main_entry\n(maestro/main.py)" as main_entry
rectangle "handle_task_command\n(maestro/commands/task.py)" as handle_task_command
rectangle "list_tasks\n(maestro/commands/task.py)" as list_tasks
rectangle "show_task\n(maestro/commands/task.py)" as show_task
rectangle "add_task\n(maestro/commands/task.py)" as add_task
rectangle "remove_task\n(maestro/commands/task.py)" as remove_task
rectangle "edit_task\n(maestro/commands/task.py)" as edit_task
rectangle "set_task_status\n(maestro/commands/task.py)" as set_task_status
rectangle "set_task_context\n(maestro/commands/task.py)" as set_task_context
rectangle "handle_task_discuss\n(maestro/commands/discuss.py)" as handle_task_discuss
rectangle "render_task_table\n(maestro/display/table_renderer.py)" as render_task_table
main_entry --> handle_task_command
handle_task_command --> list_tasks
handle_task_command --> show_task
handle_task_command --> add_task
handle_task_command --> remove_task
handle_task_command --> edit_task
handle_task_command --> set_task_status
handle_task_command --> set_task_context
handle_task_command --> handle_task_discuss
list_tasks --> render_task_table
add_task --> json_store
remove_task --> json_store
set_task_status --> json_store
edit_task --> markdown_writer
edit_task --> editor_actor
set_task_context --> settings
json_store --> maestro_tasks_json
json_store --> maestro_phases_json
markdown_writer --> docs_phases_md
settings --> settings_json

note left
  **Evidence:**
  * [[v1/internal/deep/cmd_task_deep.puml cmd_task_deep.puml]]
  * [[docs/workflows/maestro/commands/task.py task.py]]
  * [[docs/workflows/maestro/data/markdown_writer.py markdown_writer.py]]
  * [[docs/workflows/maestro/tracks/json_store.py json_store.py]]
end note

note right #FFE6E6
  **âš  Ledger Hints:**
  * Observed DataMarkdown persistence in cmd_task deep flow; v2 repo truth uses JSON
  * Shows mixed persistence model with both JSON and Markdown files; v2 spec require
  
  [[../../IMPLEMENTATION_LEDGER.md IMPLEMENTATION_LEDGER]]
  [[../../reports/ledger_candidates.md Ledger Candidates]]
end note

@enduml
