@startuml
!theme plain
skinparam backgroundColor #FFFFFF
skinparam defaultFontName Arial
skinparam ArrowColor #333333
skinparam NoteBorderColor #CCCCCC
skinparam NoteBackgroundColor #FFFFCC

title WF-03 - Combined Layers (LOD0)

note right
  **Source:** [[docs/workflows/v2/ir/wf/WF-03.intent.yaml docs/workflows/v2/ir/wf/WF-03.intent.yaml]]
end note

note as N1
  **Combined view (LOD0)**
  
  This diagram combines:
  * Intent layer (workflow logic)
  * Command integration
end note

!theme plain
skinparam backgroundColor #FFFFFF
skinparam defaultFontName Arial
skinparam ArrowColor #333333
skinparam NoteBorderColor #CCCCCC
skinparam NoteBackgroundColor #FFFFCC

title WF-03 - Read-only repo inspection + build (LOD0: Spine)

note right
  **Source:** [[docs/workflows/v2/ir/wf/WF-03.intent.yaml docs/workflows/v2/ir/wf/WF-03.intent.yaml]]
end note

(*) --> "Operator initiates read-only repo inspection or build"
if "Branch guard - ensure on correct branch" then
  -->[yes] ...
  -->[no] ...
endif
if "Check if repo command exists" then
  -->[yes] ...
  -->[no] ...
endif
if "Decide whether to build using detected plan or default build system" then
  -->[yes] ...
  -->[no] ...
endif
if "Check if init required" then
  -->[yes] ...
  -->[no] ...
endif
if "Build driver detected?" then
  -->[yes] ...
  -->[no] ...
endif
if "Make/build success?" then
  -->[yes] ...
  -->[no] ...
endif
note right #FF0000
  **HARD STOP**\nHARD STOP - Build driver detection failed
end note
"--> (*)

package "Uses Commands" #E6F3FF {
  rectangle "make" as uses_make [[../generated/svg/CMD-make.all_layers.lod0.svg]]
  rectangle "repo" as uses_repo [[../generated/svg/CMD-repo.all_layers.lod0.svg]]
}

note left
  **Evidence:**
  * [[v1/scenario_03_readonly_repo_inspect_build.md Original v1 workflow documentation]]
  * [[v1/scenario_03_readonly_repo_inspect_build.puml Original v1 workflow diagram]]
end note

note right #FFE6E6
  **âš  Ledger Hints:**
  * Workflow mentions maestro repo command which may not be registered in CLI; verif
  * Read-only mode with storage in $HOME/.maestro/repo/ may conflict with REPO_TRUTH
  
  [[../../IMPLEMENTATION_LEDGER.md IMPLEMENTATION_LEDGER]]
  [[../../reports/ledger_candidates.md Ledger Candidates]]
end note


@enduml
