@startuml cmd_convert_deep
!include _shared.puml

' Core Command Modules
' MODULE: MaestroMain, "maestro/main.py"
rectangle "main()" as MainEntry <<Function>>

' MODULE: CommandsConvert, "maestro/commands/convert.py"
rectangle "add_convert_parser()" as AddConvertParser <<Function>>
rectangle "handle_convert_new()" as HandleConvertNew <<Function>>
rectangle "handle_convert_plan()" as HandleConvertPlan <<Function>>
rectangle "handle_convert_run()" as HandleConvertRun <<Function>>
rectangle "handle_convert_status()" as HandleConvertStatus <<Function>>
rectangle "handle_convert_show()" as HandleConvertShow <<Function>>
rectangle "handle_convert_reset()" as HandleConvertReset <<Function>>
rectangle "handle_convert_batch()" as HandleConvertBatch <<Function>>

' Conversion Subsystem Modules (Actual Logic)
' MODULE: ConvertOrchestrator, "maestro/convert/convert_orchestrator.py"
rectangle "create_new_pipeline()" as CreateNewPipeline <<Function>>
rectangle "reset_pipeline()" as ResetPipeline <<Function>>

' MODULE: ConvertPlanner, "maestro/convert/planner.py"
rectangle "plan_conversion()" as PlanConversion <<Function>>

' MODULE: ConvertExecution, "maestro/convert/execution_engine.py"
rectangle "run_conversion_pipeline()" as RunConversionPipeline <<Function>>

' MODULE: UiFacadeConvert, "maestro/ui_facade/convert.py"
rectangle "get_pipeline_status()" as GetPipelineStatus <<Function>>
rectangle "PipelineStatus" as PipelineStatus <<Class>>
rectangle "PipelineStage" as PipelineStage <<Class>>

' Utility Modules
package "pathlib" as Pathlib <<Module>>
package "os" as OS <<Module>>

' External Dependencies
CLOUD(FileSystem, "File System")

' Persistent Stores (Conceptual, managed by underlying convert modules)
rectangle ".maestro/convert/\n(Pipeline definitions, state, logs)" as MaestroConvertDir <<Database>>


' --- Relationships and Call Flow ---

' CLI Command Setup
MainEntry --> AddConvertParser : "Adds 'convert' command and subparsers"

' Command Dispatch
HandleConvertNew <.. MainEntry : "for 'convert new'"
HandleConvertPlan <.. MainEntry : "for 'convert plan'"
HandleConvertRun <.. MainEntry : "for 'convert run'"
HandleConvertStatus <.. MainEntry : "for 'convert status'"
HandleConvertShow <.. MainEntry : "for 'convert show'"
HandleConvertReset <.. MainEntry : "for 'convert reset'"
HandleConvertBatch <.. MainEntry : "for 'convert batch'"

' Convert Subcommand Flow

' new
HandleConvertNew --> ConvertOrchestrator.CreateNewPipeline : "creates pipeline"
ConvertOrchestrator.CreateNewPipeline --[#Red,dashed]-> MaestroConvertDir : "writes new pipeline config"

' plan
HandleConvertPlan --> ConvertPlanner.PlanConversion : "plans conversion"
ConvertPlanner.PlanConversion --> MaestroConvertDir : "reads/writes plan state"

' run
HandleConvertRun --> ConvertExecution.RunConversionPipeline : "executes pipeline"
ConvertExecution.RunConversionPipeline --> MaestroConvertDir : "reads/writes execution state"
ConvertExecution.RunConversionPipeline --> FileSystem : "modifies project files"

' status / show
HandleConvertStatus --> UiFacadeConvert.GetPipelineStatus : "gets status summary"
HandleConvertShow --> UiFacadeConvert.GetPipelineStatus : "gets detailed status"
GetPipelineStatus --> MaestroConvertDir : "reads pipeline state"
GetPipelineStatus ..> PipelineStatus : "returns structured status"
GetPipelineStatus ..> PipelineStage : "returns structured stages"

' reset
HandleConvertReset --> ConvertOrchestrator.ResetPipeline : "resets pipeline state"
ConvertOrchestrator.ResetPipeline --[#Red,dashed]-> MaestroConvertDir : "clears/resets state"

' batch (placeholder)
HandleConvertBatch --> FileSystem : "conceptual batch operations"

' Error Handling for Imports
CommandsConvert -[#Red]-> CommandsConvert : "handles ImportError, prints user-friendly message"

' General Utilities
CommandsConvert --> Pathlib
CommandsConvert --> OS

@enduml
