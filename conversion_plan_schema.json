{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AI-Driven Conversion Plan",
  "description": "Schema for AI-driven conversion plans that map source files to target files",
  "type": "object",
  "required": ["version", "source_inventory", "target_inventory", "scaffold_tasks", "file_tasks", "final_sweep_tasks"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Version of the plan schema",
      "default": "1.0"
    },
    "source_inventory": {
      "type": "string",
      "description": "Path to source inventory file"
    },
    "target_inventory": {
      "type": "string",
      "description": "Path to target inventory file"
    },
    "scaffold_tasks": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/task"
      }
    },
    "file_tasks": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/task"
      }
    },
    "final_sweep_tasks": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/task"
      }
    },
    "checkpoints": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/checkpoint"
      },
      "description": "Explicit checkpoints for human approval during execution"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "source_repo": {
          "type": "string"
        },
        "target_repo": {
          "type": "string"
        },
        "ai_model_used": {
          "type": "string"
        }
      }
    }
  },
  "definitions": {
    "task": {
      "type": "object",
      "required": ["task_id", "phase", "source_files", "engine", "prompt_ref", "acceptance_criteria", "deliverables", "depends_on", "status"],
      "properties": {
        "task_id": {
          "type": "string",
          "description": "Unique identifier for the task"
        },
        "phase": {
          "type": "string",
          "enum": ["scaffold", "file", "sweep"],
          "description": "Phase of the conversion process"
        },
        "source_files": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of source files involved in this task"
        },
        "target_files": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of target files to be created/modified by this task"
        },
        "engine": {
          "type": "string",
          "enum": ["codex", "claude", "gpt4", "gpt3.5", "custom_converter", "file_copy", "file_delete", "directory_create"],
          "description": "AI engine to use for this task"
        },
        "prompt_ref": {
          "type": "string",
          "description": "Reference to the prompt file"
        },
        "acceptance_criteria": {
          "type": "string",
          "description": "Criteria to determine if the task was successful"
        },
        "deliverables": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of expected deliverables from this task"
        },
        "depends_on": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of task IDs this task depends on"
        },
        "status": {
          "type": "string",
          "enum": ["pending", "running", "completed", "failed", "interrupted", "skipped"],
          "default": "pending"
        }
      }
    },
    "checkpoint": {
      "type": "object",
      "required": ["checkpoint_id", "after_tasks", "label"],
      "properties": {
        "checkpoint_id": {
          "type": "string",
          "description": "Unique identifier for the checkpoint"
        },
        "after_tasks": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of task IDs after which this checkpoint should be triggered"
        },
        "label": {
          "type": "string",
          "description": "Human-readable label for the checkpoint"
        },
        "requires": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["semantic_ok", "build_pass"]
          },
          "description": "Requirements that must be met before continuing past this checkpoint"
        },
        "auto_continue": {
          "type": "boolean",
          "default": false,
          "description": "Whether execution should continue automatically after this checkpoint"
        },
        "status": {
          "type": "string",
          "enum": ["pending", "approved", "rejected", "skipped", "completed"],
          "default": "pending"
        }
      }
    }
  }
}